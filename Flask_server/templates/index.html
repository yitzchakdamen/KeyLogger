<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ניהול נתונים</title>

    <!-- קישורים לספריות חיצוניות -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Varela+Round:wght@400;700&display=swap" rel="stylesheet">

    <!-- סגנונות CSS -->
    <style>
        body {
            font-family: 'Varela Round', sans-serif;
            background-color: #f0f0f0;
            color: #333;
            text-align: center;
            padding: 30px;
            direction: rtl;
        }

        h1 {
            font-size: 2rem;
            color: #444;
            margin-bottom: 30px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background-color: white;
            padding: 40px;
            box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.1);
            border-radius: 15px;
        }

        input[type="text"], input[type="number"] {
            width: 20%;
            padding: 12px;
            margin: 10px 0;
            border-radius: 10px;
            border: 1px solid #ccc;
            font-size: 1rem;
            text-align: center;
        }

        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 14px 20px;
            margin: 10px 0;
            cursor: pointer;
            border-radius: 10px;
            font-size: 1rem;
        }

        button:hover {
            background-color: #45a049;
        }

        .result-container {
            margin-top: 20px;
            text-align: justify;
        }

        .result-box {
            background-color: #f9f9f9;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0px 2px 5px rgba(0, 0, 0, 0.1);
        }

        .result-box p {
            margin: 5px 0;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1><i class="fas fa-database"></i> ניהול נתונים</h1>



        <!-- כפתורי פעולה ראשיים -->
        <button onclick="toggleOptions('get_data')"><i class="fas fa-eye"></i> צפה בנתונים</button>
        <button onclick="toggleOptions('delete_data')"><i class="fas fa-trash-alt"></i> מחק נתונים</button>
        <br>

        <!-- שדות תאריך וזמן -->
        <div id="date-fields" style="display: none;">
                    <!-- שדה קלט לשם המחשב -->
            <input type="text" id="machine_name" placeholder="שם מחשב (לא חובה)">
            <br>
            <input type="number" id="year" placeholder="שנה (YYYY)" min="1900" max="2100">
            <input type="number" id="month" placeholder="חודש (MM)" min="1" max="12">
            <input type="number" id="day" placeholder="יום (DD)" min="1" max="31">
            <br>
            <input type="number" id="hour" placeholder="שעה (HH)" min="0" max="23">
            <input type="number" id="minute" placeholder="דקה (MM)" min="0" max="59">
            <br>
            <button onclick="sendRequest()">בצע פעולה</button>
        </div>

        <!-- שדה נסתר לשמירת הפעולה הנבחרת -->
        <input type="hidden" id="selected-action">

        <!-- אזור תוצאות -->
        <div id="result" class="result-container"></div>
    </div>

    <script>
        // פונקציה להצגה/הסתרה של שדות התאריך
        function toggleOptions(action) {
            const dateFields = document.getElementById('date-fields');
            dateFields.style.display = 'block'; // הצגת שדות התאריך
            document.getElementById('selected-action').value = action;
        }

        // פונקציה לשליחת בקשה לשרת
        async function sendRequest() {
            const action = document.getElementById('selected-action').value;

            // בדיקת אישור לפני מחיקת נתונים
            if (action === 'delete_data' && !confirm("האם אתה בטוח שברצונך למחוק את הנתונים?")) {
                return;
            }

            // איסוף כל הפרמטרים
            const params = new URLSearchParams({
                computer_name_device_id: document.getElementById("machine_name").value,
                year: document.getElementById("year").value,
                month: document.getElementById("month").value,
                day: document.getElementById("day").value,
                hour: document.getElementById("hour").value,
                minute: document.getElementById("minute").value
            });

            try {
                // שליחת בקשה לשרת
                const response = await fetch(`http://localhost:5000/${action}?${params}`);
                const data = await response.json();

                // עדכון תיבת התוצאות
                const resultDiv = document.getElementById("result");
                resultDiv.innerHTML = "";

                if (action === "get_data" && data.length > 0) {
                    data.forEach(event => {
                        resultDiv.innerHTML += `
                            <div class='result-box'>
                                <p><strong>מחשב:</strong> ${event.machine_name}</p>
                                <p><strong>תאריך:</strong> ${event.date}</p>
                                <p><strong>נתונים:</strong> ${event.data.replace(/\u2193/g, "↓")}</p>
                            </div>
                        `;
                    });
                } else {
                    resultDiv.innerHTML = `<p>${data}</p>`;
                }
            } catch (error) {
                console.error("Error:", error);
                alert("התרחשה שגיאה בטעינת הנתונים");
            }
        }
    </script>

</body>
</html>
